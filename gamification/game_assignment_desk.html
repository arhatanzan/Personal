<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>The Assignment Desk: India</title>
    <style>
      :root {
        --bg-color: #f8f6f2;
        --card-bg: #ffffff;
        --text-main: #0a2342; /* Navy */
        --text-light: #5a6673; /* Slate */
        --accent: #d4a017; /* Gold */
        --danger: #7a2e2e; /* Red */
        --success: #27ab83; /* Green */
        --border-color: rgba(10, 35, 66, 0.15);
        --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-main);
        background-color: var(--bg-color);
        color: var(--text-main);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh; /* allow content to determine actual height */
        overflow-y: auto; /* allow scrolling when content grows or zoom changes */
        /* Prevent pull-to-refresh on mobile */
        overscroll-behavior: none;
      }

      /* --- HEADER --- */
      header {
        width: 100%;
        max-width: 800px;
        padding: 0.8rem;
        text-align: center;
        flex-shrink: 0;
        border-bottom: 1px solid var(--border-color);
        background: var(--bg-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      h1 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--text-main);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .live-badge {
        background: var(--danger);
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: bold;
        animation: pulse 1.5s infinite;
      }

      /* --- DASHBOARD --- */
      .dashboard {
        width: 95%;
        max-width: 800px;
        margin: 10px 0;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        flex-shrink: 0;
      }
      .stat-box {
        background: var(--card-bg);
        padding: 8px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .stat-label {
        font-size: 0.6rem;
        text-transform: uppercase;
        color: var(--text-light);
        font-weight: bold;
      }
      .stat-bar-container {
        height: 8px;
        width: 100%;
        background: #eee;
        border-radius: 4px;
        margin-top: 5px;
        overflow: hidden;
      }
      .stat-bar {
        height: 100%;
        transition: width 0.3s ease;
      }

      /* Bar Colors */
      #bar-ratings {
        background: var(--accent);
      }
      #bar-info {
        background: var(--text-main);
      }

      .timer-box {
        font-size: 1.2rem;
        font-weight: 800;
        color: var(--danger);
      }

      /* --- GAME AREA --- */
      .game-layout {
        /* Do not force the layout to stretch to viewport height; size to content */
        flex: 0 0 auto;
        width: 100%;
        max-width: 800px;
        display: flex;
        flex-direction: column;
        overflow: visible;
        padding-bottom: 10px;
        position: relative;
      }

      /* The Broadcast Queue (Slots) */
      .broadcast-slots {
        display: flex;
        gap: 5px;
        padding: 10px 15px;
        background: #e2e8f0;
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
        justify-content: center;
        flex-shrink: 0;
      }
      .slot {
        width: 18%;
        height: 50px;
        background: rgba(255, 255, 255, 0.5);
        border: 2px dashed var(--text-light);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: var(--text-light);
        font-weight: bold;
        transition: all 0.2s;
      }
      .slot.filled {
        background: var(--text-main);
        color: white;
        border: 2px solid var(--text-main);
        font-size: 0.6rem;
        text-align: center;
        line-height: 1.1;
        padding: 2px;
      }

      /* The Incoming Feed (Whack-a-mole area) */
      .news-feed {
        position: relative;
        background: var(--bg-color);
        padding: 10px;
        overflow: visible;
        touch-action: none; /* Disables browser gestures inside game area */
      }

      /* Story Card */
      .story-card {
        position: absolute;
        width: 140px;
        height: 105px;
        background: var(--card-bg);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: transform 0.1s;
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        user-select: none; /* Critical for mobile tapping */
        -webkit-user-select: none;
      }
      .story-card:active {
        transform: scale(0.95);
      }
      .story-card.expiring {
        opacity: 0.5;
        border-color: var(--danger);
        animation: shake 0.5s infinite;
      }

      .story-tag {
        font-size: 0.6rem;
        font-weight: bold;
        text-transform: uppercase;
        padding: 2px 4px;
        border-radius: 3px;
        align-self: flex-start;
      }
      .tag-scandal {
        background: #ffe3e3;
        color: var(--danger);
      }
      .tag-policy {
        background: #e3fff5;
        color: var(--success);
      }
      .tag-fluff {
        background: #fff4ce;
        color: #947600;
      }

      .story-title {
        font-size: 0.8rem;
        font-weight: 700;
        line-height: 1.3;
        color: var(--text-main);
      }
      .story-meta {
        font-size: 0.65rem;
        color: var(--text-light);
        display: flex;
        justify-content: space-between;
      }

      /* Animations */
      @keyframes popIn {
        from {
          transform: scale(0) rotate(-5deg);
          opacity: 0;
        }
        to {
          transform: scale(1) rotate(0);
          opacity: 1;
        }
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes shake {
        0% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(2px);
        }
        75% {
          transform: translateX(-2px);
        }
        100% {
          transform: translateX(0);
        }
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(10, 35, 66, 0.95);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        color: white;
        text-align: center;
        padding: 20px;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: white;
        color: var(--text-main);
        padding: 25px;
        border-radius: 10px;
        max-width: 400px;
        width: 100%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-top: 5px solid var(--accent);
      }
      .btn-modal {
        background: var(--text-main);
        color: var(--accent);
        padding: 12px 20px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        text-transform: uppercase;
        margin-top: 15px;
      }

      .copyright {
        font-size: 0.7rem;
        color: var(--text-light);
        opacity: 0.6;
        text-align: center;
        padding: 8px;
        flex-shrink: 0;
        width: 100%;
      }

      .tutorial-step {
        font-size: 0.9rem;
        margin-bottom: 10px;
        text-align: left;
      }
      /* Small-screen responsive fixes: reduce vertical gaps and stack stat boxes */
      @media (max-width: 600px) {
        .dashboard {
          grid-template-columns: 1fr;
          gap: 8px;
          width: 95%;
          margin: 0.5rem 0;
        }
        .stats-bar { grid-template-columns: 1fr; }
        /* Avoid large vertical centering on tall small-viewports */
        .game-container, .game-layout {
          max-width: 100%;
          padding-bottom: 1rem;
          justify-content: flex-start !important;
          padding-top: 0.25rem;
          flex: 0 0 auto;
          min-height: 0;
        }
        .card-stack { height: auto !important; margin-bottom: 8px; }
        .card { position: relative !important; height: auto !important; top: auto !important; left: auto !important; padding: 1.25rem; }
        body { min-height: auto !important; height: auto !important; }
        .controls, .broadcast-slots { gap: 8px; padding: 8px; justify-content: center; }
        .btn, .btn-modal, .deal-btn { padding: 0.6rem; font-size: 0.95rem; }
        header { padding: 0.6rem; }
        .copyright { margin-top: 8px; font-size: 0.7rem; }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Assignment Desk</h1>
      <div class="live-badge">‚óè LIVE</div>
    </header>

    <div class="dashboard">
      <div class="stat-box">
        <span class="stat-label">TRP (Ratings)</span>
        <div class="stat-bar-container">
          <div class="stat-bar" id="bar-ratings" style="width: 50%"></div>
        </div>
      </div>
      <div class="stat-box">
        <span class="timer-box" id="timer">15</span>
        <span class="stat-label">Deadline</span>
      </div>
      <div class="stat-box">
        <span class="stat-label">Civic Info</span>
        <div class="stat-bar-container">
          <div class="stat-bar" id="bar-info" style="width: 50%"></div>
        </div>
      </div>
    </div>

    <div class="game-layout">
      <div class="news-feed" id="news-feed"></div>

      <div class="broadcast-slots" id="slots-container">
        <div class="slot">1</div>
        <div class="slot">2</div>
        <div class="slot">3</div>
        <div class="slot">4</div>
        <div class="slot">5</div>
      </div>
    </div>

    <div class="copyright">¬© 2025 Kaif Abbas</div>

    <div class="modal active" id="start-modal">
      <div class="modal-content">
        <h2 style="color: var(--text-main); margin-top: 0">BREAKING NEWS</h2>
        <p style="color: var(--text-light); font-size: 0.9rem">
          You are the Editor-in-Chief. You have <strong>15 seconds</strong> to
          pick 5 stories for the 9 PM broadcast.
        </p>

        <div class="tutorial-step">
          üìà <strong>TRP (Profit):</strong> Keep viewers hooked (Scandals,
          Cricket). If this hits 0, you're fired.
        </div>
        <div class="tutorial-step">
          üß† <strong>Info (Duty):</strong> Educate the public (Policy, GST). If
          this hits 0, society fails.
        </div>

        <button class="btn-modal" onclick="startGame()">Start Broadcast</button>
      </div>
    </div>

    <div class="modal" id="report-modal">
      <div class="modal-content">
        <h2 id="report-title">Hour Ended</h2>
        <p id="report-desc">...</p>
        <div
          style="
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-weight: bold;
            font-size: 0.9rem;
          "
        >
          <span id="report-rating">TRP: +0</span>
          <span id="report-info">Info: -0</span>
        </div>
        <button class="btn-modal" id="btn-next-hour" onclick="nextHour()">
          Next Hour
        </button>
      </div>
    </div>

    <script>
      // --- CONFIG ---
      const TOTAL_HOURS = 5;
      const SECONDS_PER_HOUR = 15;
      const SLOTS_PER_HOUR = 5;

      // --- INDIAN CONTEXT STORIES ---
      const STORIES = [
        // HIGH TRP, LOW INFO (Masala/Fluff)
        {
          title: "Cricketer buys 5 Cr SUV: PICS!",
          type: "Fluff",
          rating: +15,
          info: -5,
        },
        {
          title: "Ambani Wedding: Who wore what?",
          type: "Fluff",
          rating: +12,
          info: -5,
        },
        {
          title: "Viral: Noida Road Rage Video",
          type: "Fluff",
          rating: +15,
          info: -2,
        },
        {
          title: "Actor spotted at Airport (Gym Look)",
          type: "Fluff",
          rating: +10,
          info: -2,
        },
        {
          title: "Zomato guy vs Customer: FIGHT!",
          type: "Fluff",
          rating: +18,
          info: -5,
        },

        // HIGH TRP, NEGATIVE INFO (Toxic Debates)
        {
          title: "DEBATE: Anchor Shouts for 20 Mins",
          type: "Scandal",
          rating: +20,
          info: -10,
        },
        {
          title: "Hindu-Muslim Debate: Shout Match",
          type: "Scandal",
          rating: +25,
          info: -15,
        },
        {
          title: "Politician Slaps Official on Cam",
          type: "Scandal",
          rating: +18,
          info: -5,
        },

        // LOW TRP, HIGH INFO (Vegetables)
        {
          title: "GST Council: New Tax Slab Details",
          type: "Policy",
          rating: -10,
          info: +20,
        },
        {
          title: "Groundwater Report: Crisis Ahead",
          type: "Policy",
          rating: -8,
          info: +25,
        },
        {
          title: "RBI Keeps Repo Rate Unchanged",
          type: "Policy",
          rating: -12,
          info: +15,
        },
        {
          title: "Farmer MSP Demands Explained",
          type: "Policy",
          rating: -5,
          info: +20,
        },
        {
          title: "Start-up IPO Regulations Update",
          type: "Policy",
          rating: -10,
          info: +15,
        },

        // BALANCED (Rare Gems)
        {
          title: "ISRO Launch Successful",
          type: "News",
          rating: +10,
          info: +10,
        },
        {
          title: "Election Phase 1: Voter Turnout",
          type: "News",
          rating: +8,
          info: +10,
        },
        {
          title: "New Metro Line Opens Today",
          type: "News",
          rating: +5,
          info: +5,
        },
      ];

      // --- STATE ---
      let state = {
        hour: 1,
        ratings: 50,
        info: 50,
        timeLeft: SECONDS_PER_HOUR,
        storiesAired: 0,
        gameInterval: null,
        spawnInterval: null,
        activeStories: [],
      };

      // --- CORE LOGIC ---
      function startGame() {
        document.getElementById("start-modal").classList.remove("active");
        startRound();
      }

      function startRound() {
        // Reset Round State
        state.timeLeft = SECONDS_PER_HOUR;
        state.storiesAired = 0;
        state.activeStories = [];

        document.getElementById("news-feed").innerHTML = ""; // Clear board
        document.querySelectorAll(".slot").forEach((el, i) => {
          el.className = "slot";
          el.innerText = i + 1;
        });

        updateUI();

        // Start Timers
        clearInterval(state.gameInterval);
        clearInterval(state.spawnInterval);

        state.gameInterval = setInterval(gameTick, 1000);
        state.spawnInterval = setInterval(spawnStory, 750); // Slightly faster spawn
      }

      function gameTick() {
        state.timeLeft--;
        updateUI();

        if (state.timeLeft <= 0) {
          endRound("Deadline Missed!");
        }
      }

      function spawnStory() {
        // Don't overpopulate (Responsive limits)
        const maxStories = window.innerWidth < 600 ? 5 : 7;
        if (document.getElementById("news-feed").childElementCount > maxStories)
          return;

        const storyData = STORIES[Math.floor(Math.random() * STORIES.length)];
        const id = "story-" + Date.now() + Math.random();

        // Random Position (Keep within bounds)
        const container = document.getElementById("news-feed");
        // Ensure card fits on screen
        const maxX = container.clientWidth - 145;
        const maxY = container.clientHeight - 110;

        const x = Math.random() * maxX;
        const y = Math.random() * maxY;

        const el = document.createElement("div");
        el.className = "story-card";
        el.style.left = x + "px";
        el.style.top = y + "px";
        el.id = id;

        let tagClass =
          storyData.type === "Scandal"
            ? "tag-scandal"
            : storyData.type === "Policy"
            ? "tag-policy"
            : "tag-fluff";

        el.innerHTML = `
            <span class="story-tag ${tagClass}">${storyData.type}</span>
            <div class="story-title">${storyData.title}</div>
            <div class="story-meta">
                <span>‚≠ê ${storyData.rating > 0 ? "+" : ""}${
          storyData.rating
        }</span>
                <span>üß† ${storyData.info > 0 ? "+" : ""}${
          storyData.info
        }</span>
            </div>
        `;

        el.onmousedown = (e) => {
          e.stopPropagation();
          airStory(storyData, id);
        };
        // Touch support
        el.ontouchstart = (e) => {
          e.stopPropagation();
          e.preventDefault();
          airStory(storyData, id);
        };

        container.appendChild(el);

        // Auto-remove after 3 seconds (The "Whack-a-mole" expiry)
        setTimeout(() => {
          const currentEl = document.getElementById(id);
          if (currentEl) {
            currentEl.classList.add("expiring");
            setTimeout(() => {
              if (currentEl) currentEl.remove();
            }, 1000);
          }
        }, 3000);
      }

      function airStory(data, id) {
        // Remove from feed
        const el = document.getElementById(id);
        if (el) el.remove();

        // Update Stats
        state.ratings = clamp(state.ratings + data.rating, 0, 100);
        state.info = clamp(state.info + data.info, 0, 100);

        // Update Slots UI
        state.storiesAired++;
        const slot = document.querySelectorAll(".slot")[state.storiesAired - 1];
        if (slot) {
          slot.classList.add("filled");
          slot.innerText = data.type; // Show type in slot
        }

        updateUI();

        // Check Round End
        if (state.storiesAired >= SLOTS_PER_HOUR) {
          endRound("Broadcast Complete!");
        }

        // Check Game Over (Early)
        if (state.ratings <= 0 || state.info <= 0) {
          gameOver();
        }
      }

      function endRound(reason) {
        clearInterval(state.gameInterval);
        clearInterval(state.spawnInterval);

        const m = document.getElementById("report-modal");
        const t = document.getElementById("report-title");
        const d = document.getElementById("report-desc");
        const b = document.getElementById("btn-next-hour");

        m.classList.add("active");
        t.innerText = `Hour ${state.hour} Ended`;
        d.innerText = reason;

        document.getElementById(
          "report-rating"
        ).innerText = `TRP: ${state.ratings}%`;
        document.getElementById(
          "report-info"
        ).innerText = `Info: ${state.info}%`;

        if (state.hour >= TOTAL_HOURS) {
          b.innerText = "See Final Results";
          b.onclick = gameOver;
        } else {
          b.innerText = "Start Next Hour";
          b.onclick = nextHour;
        }
      }

      function nextHour() {
        document.getElementById("report-modal").classList.remove("active");
        state.hour++;
        startRound();
      }

      function gameOver() {
        clearInterval(state.gameInterval);
        clearInterval(state.spawnInterval);

        const m = document.getElementById("report-modal");
        m.classList.add("active");
        const t = document.getElementById("report-title");
        const d = document.getElementById("report-desc");
        const b = document.getElementById("btn-next-hour");

        // End Game Logic
        if (state.ratings <= 0) {
          t.innerText = "FIRED!";
          t.style.color = "var(--danger)";
          d.innerText =
            "Your channel's ratings crashed. Advertisers pulled out. You are out of a job.";
        } else if (state.info <= 0) {
          t.innerText = "DEMOCRACY FAILED";
          t.style.color = "var(--danger)";
          d.innerText =
            "You have high ratings, but the public is totally misinformed. You failed your country.";
        } else if (state.ratings > 80 && state.info < 30) {
          t.innerText = "SENSATIONALIST";
          t.style.color = "#d4a017";
          d.innerText =
            "You are rich and famous, but your news is garbage. A hollow victory.";
        } else if (state.ratings > 50 && state.info > 50) {
          t.innerText = "LEGENDARY EDITOR";
          t.style.color = "var(--success)";
          d.innerText =
            "Incredible! You made money AND informed the public. The hardest job in the world.";
        } else {
          t.innerText = "SURVIVOR";
          t.style.color = "var(--text-main)";
          d.innerText =
            "You kept your job and the country is... okay. Not great, not terrible.";
        }

        b.innerText = "Play Again";
        b.onclick = () => location.reload();
      }

      function updateUI() {
        document.getElementById("timer").innerText = state.timeLeft;
        document.getElementById("bar-ratings").style.width =
          state.ratings + "%";
        document.getElementById("bar-info").style.width = state.info + "%";

        // Color changes for danger zones
        if (state.timeLeft < 5)
          document.getElementById("timer").style.color = "red";
      }

      function clamp(val, min, max) {
        return Math.min(Math.max(val, min), max);
      }
    </script>
  </body>
</html>
