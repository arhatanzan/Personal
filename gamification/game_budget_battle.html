<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Budget Battle</title>
    <style>
      :root {
        --bg-color: #f4f7f6;
        --card-bg: #ffffff;
        --text-main: #0a2342;
        --text-light: #5a6673;
        --accent: #d4a017;
        --danger: #d64545;
        --success: #27ab83;
        --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-main);
        background-color: var(--bg-color);
        color: var(--text-main);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        /* Allow scrolling on body if content is tall */
        overflow-y: auto;
        padding-bottom: 20px;
      }

      /* --- HEADER --- */
      header {
        width: 100%;
        max-width: 800px;
        padding: 1rem;
        text-align: center;
        background: transparent;
      }
      h1 {
        margin: 0;
        font-size: 1.2rem;
        color: var(--text-main);
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 800;
      }

      /* --- DASHBOARD --- */
      .dashboard {
        width: 95%;
        max-width: 800px;
        margin-bottom: 15px;
        display: flex;
        gap: 10px;
      }
      .stat-box {
        background: var(--card-bg);
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid #e2e8f0;
        flex: 1;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .stat-label {
        font-size: 0.6rem;
        text-transform: uppercase;
        color: var(--text-light);
        font-weight: bold;
        margin-bottom: 4px;
      }
      .stat-val {
        font-size: 1.2rem;
        font-weight: 800;
        color: var(--text-main);
      }
      .val-funds.negative {
        color: var(--danger);
      }

      .risk-bar-bg {
        width: 100%;
        height: 6px;
        background: #eee;
        border-radius: 3px;
        margin-top: 4px;
        overflow: hidden;
      }
      .risk-bar-fill {
        height: 100%;
        width: 0%;
        background: var(--danger);
        transition: width 0.3s;
      }

      /* --- DEALS SECTION (Fixed Alignment) --- */
      .deals-wrapper {
        width: 95%;
        max-width: 800px;
        margin-bottom: 15px;
      }
      .deals-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Force 4 equal columns */
        gap: 10px;
      }

      .deal-btn {
        background: var(--text-main);
        color: white;
        border: none;
        padding: 10px 5px;
        border-radius: 6px;
        font-size: 0.7rem;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: transform 0.1s, opacity 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        min-height: 50px;
      }
      .deal-btn:hover {
        transform: translateY(-2px);
      }
      .deal-btn.taken {
        background: #cbd5e1;
        color: #64748b;
        cursor: default;
        transform: none;
        box-shadow: none;
      }
      .deal-money {
        color: var(--accent);
        font-weight: 800;
        font-size: 0.8rem;
        margin-bottom: 2px;
      }

      /* --- SECTORS GRID (Fixed Spacing) --- */
      .game-area {
        width: 95%;
        max-width: 800px;
        margin-bottom: 20px;
      }

      .sectors-grid {
        display: grid;
        grid-template-columns: 1fr; /* Mobile: 1 Col */
        gap: 12px;
      }
      /* Desktop: 2 Cols */
      @media (min-width: 600px) {
        .sectors-grid {
          grid-template-columns: 1fr 1fr;
        }
        /* The FIX: Make the last item span 2 columns if it's odd */
        .sector-card:last-child:nth-child(odd) {
          grid-column: span 2;
        }
      }

      .sector-card {
        background: var(--card-bg);
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 15px;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
      }

      .sector-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px; /* More space for the marker */
      }
      .sector-name {
        font-weight: 700;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-main);
      }
      .sector-current {
        font-family: monospace;
        font-weight: bold;
        font-size: 1rem;
        color: var(--text-main);
      }

      /* Slider with Marker */
      .slider-wrap {
        position: relative;
        height: 24px;
        display: flex;
        align-items: center;
      }

      input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        background: transparent;
        z-index: 2;
        cursor: pointer;
      }
      input[type="range"]:focus {
        outline: none;
      }

      /* Thumb */
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 22px;
        width: 22px;
        border-radius: 50%;
        background: var(--accent);
        margin-top: -9px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        border: 3px solid #fff;
      }
      /* Track */
      input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
      }

      /* The Visual Marker (Goal) */
      .demand-marker {
        position: absolute;
        top: -5px;
        width: 2px;
        height: 16px;
        background: var(--danger);
        z-index: 1;
        pointer-events: none;
      }
      /* The Red Triangle */
      .demand-marker::before {
        content: "‚ñº";
        position: absolute;
        top: -10px;
        left: -5px;
        color: var(--danger);
        font-size: 10px;
      }
      /* The "Goal: 40" Text */
      .demand-label {
        position: absolute;
        top: -24px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.65rem;
        color: var(--danger);
        font-weight: 700;
        white-space: nowrap;
      }

      /* --- FOOTER --- */
      .footer {
        width: 95%;
        max-width: 800px;
        text-align: center;
      }
      .reaction-bar {
        background: #f1f5f9;
        padding: 10px;
        border-radius: 6px;
        font-size: 0.85rem;
        color: var(--text-light);
        font-style: italic;
        text-align: center;
        margin-bottom: 12px;
        border: 1px solid #e2e8f0;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .reaction-bar.angry {
        color: var(--danger);
        background: #fff5f5;
        border-color: #feb2b2;
        font-weight: bold;
      }
      .reaction-bar.happy {
        color: var(--success);
        background: #f0fdf4;
        border-color: #bbf7d0;
        font-weight: bold;
      }

      .btn-submit {
        width: 100%;
        padding: 15px;
        background: var(--text-main);
        color: #fff;
        border: none;
        border-radius: 8px;
        font-weight: 800;
        text-transform: uppercase;
        font-size: 1rem;
        cursor: pointer;
        letter-spacing: 1px;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        transition: transform 0.1s;
      }
      .btn-submit:active {
        transform: translateY(2px);
        box-shadow: none;
      }
      .btn-submit:disabled {
        background: #cbd5e1;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      .copyright {
        margin-top: 10px;
        font-size: 0.7rem;
        color: #999;
      }

      .subtitle {
        font-size: 0.85rem;
        color: var(--text-light);
        margin-top: 5px;
        font-weight: 500;
        letter-spacing: 0.5px;
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(10, 35, 66, 0.98);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        color: white;
        text-align: center;
        padding: 20px;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: white;
        color: var(--text-main);
        padding: 30px;
        border-radius: 12px;
        max-width: 450px;
        width: 100%;
        border-top: 6px solid var(--accent);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      }
      .btn-restart {
        background: var(--accent);
        color: var(--text-main);
        padding: 12px 25px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        width: 100%;
        font-size: 1rem;
      }

      /* Mobile tweaks */
      @media (max-width: 500px) {
        .deals-grid {
          grid-template-columns: 1fr 1fr;
        } /* 2x2 on small screens */
        .deal-btn {
          min-height: 60px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Budget Battle</h1>
      <div class="subtitle">Pick your winning allocations</div>
    </header>

    <div class="dashboard">
      <div class="stat-box">
        <span class="stat-label">Budget Left</span>
        <div class="stat-val val-funds" id="val-funds">‚Çπ100 Cr</div>
      </div>
      <div class="stat-box">
        <span class="stat-label">Approval</span>
        <div class="stat-val" id="val-approval">35%</div>
      </div>
      <div class="stat-box">
        <span class="stat-label">Corruption Risk</span>
        <div class="risk-bar-bg">
          <div class="risk-bar-fill" id="val-risk"></div>
        </div>
        <div style="font-size: 0.65rem; margin-top: 4px" id="risk-text">
          Safe
        </div>
      </div>
    </div>

    <div class="deals-wrapper">
      <div class="deals-grid" id="deals-container"></div>
    </div>

    <div class="game-area">
      <div class="sectors-grid" id="sectors-grid"></div>
    </div>

    <div class="footer">
      <div class="reaction-bar" id="reaction-box">
        Media: 'City unsafe at night.'
      </div>
      <button class="btn-submit" id="btn-submit" onclick="finalizeBudget()">
        Finalize Budget
      </button>
      <div class="copyright">¬© 2025 Kaif Abbas</div>
    </div>

    <div class="modal" id="end-modal">
      <div class="modal-content">
        <h2 id="end-title">Result</h2>
        <p id="end-desc" style="line-height: 1.6; font-size: 1rem; color: #555">
          ...
        </p>
        <button class="btn-restart" onclick="location.reload()">
          Play Again
        </button>
      </div>
    </div>

    <script>
      // --- CONFIG ---
      let currentBudget = 100;
      let corruptionRisk = 0;
      const MAX_SLIDER = 60;

      const DEALS = [
        { id: "builder", title: "Sell Park", gain: 30, risk: 25 },
        { id: "water", title: "Privatize Water", gain: 25, risk: 20 },
        { id: "corp", title: "Corp Donation", gain: 15, risk: 15 },
        { id: "data", title: "Sell Data", gain: 10, risk: 10 },
      ];

      const SECTORS = [
        {
          id: "roads",
          icon: "üöß",
          name: "Infra & Roads",
          demand: 40,
          current: 20,
          reactions: {
            low: "RWA: 'Fix the potholes first!'",
            high: "Contractors: 'Excellent work sir.'",
          },
        },
        {
          id: "police",
          icon: "üëÆ",
          name: "Police",
          demand: 35,
          current: 10,
          reactions: {
            low: "Media: 'City unsafe at night.'",
            high: "DGP: 'Force modernization on track.'",
          },
        },
        {
          id: "water",
          icon: "üíß",
          name: "Water",
          demand: 30,
          current: 20,
          reactions: {
            low: "Slums: 'Water tanker mafia rules.'",
            high: "Public: 'Clean water for all!'",
          },
        },
        {
          id: "health",
          icon: "üè•",
          name: "Health",
          demand: 30,
          current: 20,
          reactions: {
            low: "Docs: 'No oxygen in clinics.'",
            high: "Union: 'Best healthcare in state.'",
          },
        },
        {
          id: "school",
          icon: "üéì",
          name: "Education",
          demand: 25,
          current: 20,
          reactions: {
            low: "Parents: 'School roof leaking.'",
            high: "Teachers: 'Digital classrooms approved.'",
          },
        },
      ];

      function init() {
        renderDeals();
        renderSectors();
        calculateStats();
      }

      function renderDeals() {
        const c = document.getElementById("deals-container");
        DEALS.forEach((d) => {
          const b = document.createElement("button");
          b.className = "deal-btn";
          b.id = `btn-${d.id}`;
          b.innerHTML = `<span class="deal-money">+‚Çπ${d.gain}Cr</span>${d.title}`;
          b.onclick = () => takeDeal(d);
          c.appendChild(b);
        });
      }

      function takeDeal(d) {
        const btn = document.getElementById(`btn-${d.id}`);
        if (btn.classList.contains("taken")) return;

        currentBudget += d.gain;
        corruptionRisk += d.risk;
        btn.classList.add("taken");
        btn.innerHTML = `<span style="font-size:1.2rem">ü§ù</span>Deal Signed`;

        const box = document.getElementById("reaction-box");
        box.innerText = `SECRET: Took money from ${d.title}. Risk up!`;
        box.className = "reaction-bar angry";

        calculateStats();
      }

      function renderSectors() {
        const grid = document.getElementById("sectors-grid");
        SECTORS.forEach((s, idx) => {
          const card = document.createElement("div");
          card.className = "sector-card";

          // Calculate marker percentage
          const markerPos = (s.demand / MAX_SLIDER) * 100;

          card.innerHTML = `
                <div class="sector-top">
                    <span class="sector-name">${s.icon} ${s.name}</span>
                    <span class="sector-current" id="disp-${idx}">‚Çπ${s.current} Cr</span>
                </div>
                <div class="slider-wrap">
                    <div class="demand-marker" style="left: ${markerPos}%">
                        <span class="demand-label">Demand: ${s.demand}</span>
                    </div>
                    <input type="range" min="0" max="${MAX_SLIDER}" value="${s.current}" 
                        oninput="updateSector(${idx}, this.value)">
                </div>
            `;
          grid.appendChild(card);
        });
      }

      function updateSector(idx, val) {
        SECTORS[idx].current = parseInt(val);
        document.getElementById(`disp-${idx}`).innerText = `‚Çπ${val} Cr`;

        const s = SECTORS[idx];
        const box = document.getElementById("reaction-box");

        if (s.current < s.demand - 5) {
          box.innerText = s.reactions.low;
          box.className = "reaction-bar angry";
        } else if (s.current >= s.demand) {
          box.innerText = s.reactions.high;
          box.className = "reaction-bar happy";
        } else {
          box.innerText = "Stakeholders are watching closely...";
          box.className = "reaction-bar";
        }

        calculateStats();
      }

      function calculateStats() {
        const used = SECTORS.reduce((acc, s) => acc + s.current, 0);
        const left = currentBudget - used;

        const fundEl = document.getElementById("val-funds");
        fundEl.innerText = `‚Çπ${left} Cr`;

        const btn = document.getElementById("btn-submit");
        if (left < 0) {
          fundEl.classList.add("negative");
          btn.innerText = "Over Budget!";
          btn.disabled = true;
        } else {
          fundEl.classList.remove("negative");
          btn.innerText = "Finalize Budget";
          btn.disabled = false;
        }

        // Approval Calculation
        let app = 30;
        SECTORS.forEach((s) => {
          if (s.current >= s.demand) app += 10;
          else if (s.demand - s.current < 10) app += 5;
        });

        app -= corruptionRisk * 0.2;
        app = Math.min(100, Math.max(0, Math.floor(app)));

        document.getElementById("val-approval").innerText = `${app}%`;

        // Risk Meter
        document.getElementById("val-risk").style.width = `${corruptionRisk}%`;
        const rTxt = document.getElementById("risk-text");
        if (corruptionRisk > 50) {
          rTxt.innerText = "HIGH RISK";
          rTxt.style.color = "var(--danger)";
        } else {
          rTxt.innerText = "Safe";
          rTxt.style.color = "var(--text-light)";
        }
      }

      function finalizeBudget() {
        const modal = document.getElementById("end-modal");
        const t = document.getElementById("end-title");
        const d = document.getElementById("end-desc");
        const app = document.getElementById("val-approval").innerText;

        modal.classList.add("active");

        // Chance of Scandal based on Risk
        if (Math.random() * 100 < corruptionRisk) {
          t.innerText = "SCANDAL EXPOSED!";
          t.style.color = "var(--danger)";
          d.innerHTML = `
                <strong>Breaking News:</strong> A whistleblower leaked details of your secret deals.
                <br><br>
                Public trust has collapsed. You are forced to resign.
                <br><br>
                <small>Lesson: Corruption is a shortcut to a dead end.</small>
            `;
        } else if (parseInt(app) >= 60) {
          t.innerText = "RE-ELECTED!";
          t.style.color = "var(--success)";
          d.innerHTML = `
                You balanced the budget and kept the city running.
                <br><br>
                <strong>Final Approval: ${app}</strong>
                <br>
                (You survived the term!)
            `;
        } else {
          t.innerText = "DEFEATED";
          t.style.color = "#d4a017";
          d.innerHTML = `
                Voters are unhappy with the poor services.
                <br><br>
                <strong>Final Approval: ${app}</strong>
                <br>
                (You lost the election.)
            `;
        }
      }

      init();
    </script>
  </body>
</html>
